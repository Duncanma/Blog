<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.54.0" />

    
    
    

<title> â€¢ Duncan Mackenzie</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="I was just reading the latest dotnetwire newsletter and this article caught my eye.
 Synchronize Identity Values between Database and DataSet During Updates
After inserting the rows in the database your DataTable does not automatically reflect the identity values of as assigned by the database. The problem can be solved by the clever use of stored procedures and output parameters.
 It gives a very brief description of an important idea, how to return identity values from an insert without having to do another complete select query (even if you batch it together)."/>

<meta property="og:title" content="" />
<meta property="og:description" content="I was just reading the latest dotnetwire newsletter and this article caught my eye.
 Synchronize Identity Values between Database and DataSet During Updates
After inserting the rows in the database your DataTable does not automatically reflect the identity values of as assigned by the database. The problem can be solved by the clever use of stored procedures and output parameters.
 It gives a very brief description of an important idea, how to return identity values from an insert without having to do another complete select query (even if you batch it together)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://duncanmackenzie.net/posts/2004-01-20-short-but-sweet-little-example-from-todays-net-wire/" />



    






<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://duncanmackenzie.net/">Duncan Mackenzie</a>
      </span>
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Duncan Mackenzie</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1></h1>
    
    
<div class="post__meta">
    
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 2 min read
</div>


  </header>
  
  
  <div class="post">
    <p>I was just reading the latest <a href="http://www.dotnetwire.com/default.asp" target="_blank">dotnetwire</a> newsletter and this article caught my eye.</p>

<blockquote>
<p><a href="http://www.dotnetwire.com/redirect.asp?newsid=5329" target="_blank">Synchronize Identity Values between Database and DataSet During Updates</a></p>

<p>After inserting the rows in the database your DataTable does not automatically reflect the identity values of as assigned by the database. The problem can be solved by the clever use of stored procedures and output parameters.</p>
</blockquote>

<p>It gives a <strong>very brief</strong> description of an important idea, how to return identity values from an insert without having to do another complete select query (even if you batch it together). I see only one small problem with the sample (besides how little detail it covers) and it is a very common mistake; the use of <strong>@@IDENTITY</strong> to return the PK value from an INSERT.</p>

<p>Assuming you have SQL Server 2000 or later, I wouldn&#8217;t recommend using <strong>@@IDENTITY</strong> to return the PK of the last inserted record, I&#8217;d use <strong>SCOPE_IDENTITY( )</strong> instead. <strong>@@IDENTITY</strong> returns the last inserted identity value, which isn&#8217;t necessarily the record you were just inserted. If a trigger, or multiple chained triggers, has fired in response to your insert it is possible you will retrieve a PK value from a completely different table. <strong>SCOPE_IDENTITY( )</strong>, on the other hand, returns the last identity value <strong>in the same scope, which is the Insert you just executed</strong>.</p>

<p>If you are looking for information on this topic, check out William Vaughn&#8217;s article on just this subject: <a href="http://msdn.microsoft.com/vbasic/using/understanding/data/default.aspx?pull=/library/en-us/dnadonet/html/manidcrisis.asp" target="_blank" class="broken_link"><b>Managing an @@IDENTITY Crisis</b></a>.</p>

<p>The SQL docs on <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/tsqlref/ts_globals_50u1.asp" target="_blank"><b>@@IDENTITY</b></a> and <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/tsqlref/ts_sa-ses_6n8p.asp?frame=true" target="_blank"><b>SCOPE_IDENTITY()</b></a> might also be useful.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/2004-01-21-netscan-queries/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle"></span>
    </a>
    
    
    <a href="/posts/2004-01-19-clr-spy/" class="navigation-next">
      <span class="navigation-tittle"></span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
