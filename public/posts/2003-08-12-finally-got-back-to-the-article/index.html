<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.54.0" />

    
    
    

<title> • Duncan Mackenzie</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Thanks to everyone who emailed me and offered to help&#8230; but the problem was time, not technical&#8230; despite my joke about working on the cool stuff first, a ton of high-priority stuff has made me weeks late on my article!
Although I did hit some snags with odd unsorted feeds (MSDN&#8217;s!), I managed to get everything working the way I wanted. I&#8217;m still a little unhappy with the system because I don&#8217;t strip out potentially bad tags from any HTML content included in the RSS (as per http://diveintomark."/>

<meta property="og:title" content="" />
<meta property="og:description" content="Thanks to everyone who emailed me and offered to help&#8230; but the problem was time, not technical&#8230; despite my joke about working on the cool stuff first, a ton of high-priority stuff has made me weeks late on my article!
Although I did hit some snags with odd unsorted feeds (MSDN&#8217;s!), I managed to get everything working the way I wanted. I&#8217;m still a little unhappy with the system because I don&#8217;t strip out potentially bad tags from any HTML content included in the RSS (as per http://diveintomark." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://duncanmackenzie.net/posts/2003-08-12-finally-got-back-to-the-article/" />



    






<link rel="stylesheet" href="/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css" integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://duncanmackenzie.net/">Duncan Mackenzie</a>
      </span>
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Duncan Mackenzie</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1></h1>
    
    
<div class="post__meta">
    
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    

<p>Thanks to everyone who emailed me and offered to help&#8230; but the problem was time, not technical&#8230; despite my joke about working on the cool stuff first, a ton of high-priority stuff has made me weeks late on my article!</p>

<p>Although I did hit some snags with odd unsorted feeds (MSDN&#8217;s!), I managed to get everything working the way I wanted. I&#8217;m still a little unhappy with the system because I don&#8217;t strip out potentially bad tags from any HTML content included in the RSS (as per <a href="http://diveintomark.org/archives/2003/06/12/how_to_consume_rss_safely">http://diveintomark.org/archives/2003/06/12/how_to_consume_rss_safely</a>) , but it has certainly progressed far enough in code for me to finish up the article.</p>

<hr />

<p>I wrote all of the code you&#8217;ve seen so far, and tested the various bits of XSL code, using a small sample application (see Figure 2). I ended up throwing that sample away as I continued on, but for now it is a good way to test my code against various RSS feeds.</p>

<p><img src="http://www.duncanmackenzie.net/rssviewer.jpg" border="0" /></p>

<p><strong>Figure 2</strong></p></p>

<h3 id="making-sure-everything-is-in-order">Making Sure Everything is in Order</h3>

<p>The first problem I ran into was that some feeds were not displaying in descending date order (most recent item first), which was fairly confusing. It turns out that, while most RSS feeds are already sorted in descending order by date, the MSDN feeds are a notable exception. For consistency I decided to add sorting code to the XSL through the xsl:sort element. My failure to get sorting to work directly against the pubDate value resulted in one of the more interesting aspects of that transform, as I needed to include a user-defined function (written using Visual Basic .NET), to convert the string-based date value into a new format that can be sorted.</p>

<pre class="code"><font color="#000000"></font><font color="#0000FF">&lt;</font><font color="#800000">msxsl:script </font><font color="#FF0000">language</font><font color="#0000FF">="vb" </font><font color="#FF0000">implements-prefix</font><font color="#0000FF">="utility"&gt;
</font><font color="#000000">function GetDate(pubDate As String)
  Try
      Dim myDate as Date = CDate(pubDate)
      Return myDate.ToString("yyyyMMddHHmmss")
  Catch
  
  End Try
end function
</font><font color="#0000FF">&lt;/</font><font color="#800000">msxsl:script</font><font color="#0000FF">&gt;
</font>
</pre>

<p>The function itself is pretty straightforward, I just try to convert from string to date and then I output back to a string in a format that will allow for easy sorting. Using the xsl:sort function, I use the results of that function to perform the actual sort.</p>

<pre class="code"><font color="#000000"></font><font color="#0000FF">&lt;</font><font color="#800000">xsl:template </font><font color="#FF0000">match</font><font color="#0000FF">="/rss/channel"&gt;
    &lt;</font><font color="#800000">xsl:for-each </font><font color="#FF0000">select</font><font color="#0000FF">="./item"&gt;
        &lt;</font><font color="#800000">xsl:sort </font><font color="#FF0000">order</font><font color="#0000FF">="descending"
         </font><font color="#FF0000">select</font><font color="#0000FF">="utility:GetDate(./pubDate)" /&gt;
        &lt;</font><font color="#800000">xsl:apply-templates </font><font color="#FF0000">select</font><font color="#0000FF">="." /&gt;
    &lt;/</font><font color="#800000">xsl:for-each</font><font color="#0000FF">&gt;
&lt;/</font><font color="#800000">xsl:template</font><font color="#0000FF">&gt;
</font>
</pre>

<p>The Try…Catch block around the GetDate function doesn&#8217;t handle the error, but it allows the XSL to still function, even if the code is unable to parse the date string.</p>

<h3 id="variety-is-the-spice-of-life-unless-it-is-in-your-rss">Variety is the Spice of Life, unless it is in your RSS</h3>

<p>The specification for RSS is flexible in many ways, including the proper handling of HTML content and how dates should be specified, which is to say that it allows for multiple methods. This flexibility is great when you are writing a system to output RSS, but it makes life a little difficult when you are trying to read it in. This flexibility caused me a problem with the date first, most feeds I was testing were using a &#8220;pubDate&#8221; element, but a few were using a &#8220;dc:date&#8221; element instead. I dealt with the issue by adding an xsl:choose function to use and display whichever date attribute was available.</p>

<pre class="code"><font color="#000000"></font><font color="#0000FF">&lt;</font><font color="#800000">xsl:choose</font><font color="#0000FF">&gt;
    &lt;</font><font color="#800000">xsl:when </font><font color="#FF0000">test</font><font color="#0000FF">='pubDate'&gt;
        &lt;</font><font color="#800000">p</font><font color="#0000FF">&gt;</font><font color="#000000">Posted on: 
            </font><font color="#0000FF">&lt;</font><font color="#800000">xsl:value-of </font><font color="#FF0000">select</font><font color="#0000FF">="pubDate" /&gt;&lt;/</font><font color="#800000">p</font><font color="#0000FF">&gt;
    &lt;/</font><font color="#800000">xsl:when</font><font color="#0000FF">&gt;
    &lt;</font><font color="#800000">xsl:when </font><font color="#FF0000">test</font><font color="#0000FF">='dc:date'&gt;
        &lt;</font><font color="#800000">p</font><font color="#0000FF">&gt;</font><font color="#000000">Posted on: 
            </font><font color="#0000FF">&lt;</font><font color="#800000">xsl:value-of </font><font color="#FF0000">select</font><font color="#0000FF">="dc:date" /&gt;&lt;/</font><font color="#800000">p</font><font color="#0000FF">&gt;
    &lt;/</font><font color="#800000">xsl:when</font><font color="#0000FF">&gt;
    &lt;</font><font color="#800000">xsl:otherwise</font><font color="#0000FF">&gt;
    &lt;</font><font color="#800000">p</font><font color="#0000FF">&gt;</font><font color="#000000">Couldn't Retrieve Date</font><font color="#0000FF">&lt;/</font><font color="#800000">p</font><font color="#0000FF">&gt;
    &lt;/</font><font color="#800000">xsl:otherwise</font><font color="#0000FF">&gt;
&lt;/</font><font color="#800000">xsl:choose</font><font color="#0000FF">&gt;
</font>
</pre>

<p>I had to use a similar method for handling any HTML content inside of the downloaded RSS feed, using an xsl:choose to determine between the three main methods of handling HTML content inside an RSS feed. The three more common methods are:</p>

<ul>
<li>Flag the HTML block with a content:encoding tag and HTML encode all of the tags,</li>
<li>Place the HTML into an xhtml:body element, and leave the HTML tags intact, or</li>
<li>Just leave it unmarked and inline just like plain text.</li>
</ul>

<p>To make sure I could handle each of these three cases, I used another xsl:choose function (in the XSLT) to pick the right implementation for each specific format, and to just assume un-encoded content if I cannot determine the exact method being employed.</p>

<pre class="code"><font color="#000000"></font><font color="#0000FF">&lt;</font><font color="#800000">xsl:choose</font><font color="#0000FF">&gt;
    &lt;</font><font color="#800000">xsl:when </font><font color="#FF0000">test</font><font color="#0000FF">='xhtml:body'&gt;
        &lt;</font><font color="#800000">xsl:copy-of </font><font color="#FF0000">select</font><font color="#0000FF">='xhtml:body'/&gt;
    &lt;/</font><font color="#800000">xsl:when</font><font color="#0000FF">&gt;
    &lt;</font><font color="#800000">xsl:when </font><font color="#FF0000">test</font><font color="#0000FF">='content:encoded'&gt;
        &lt;</font><font color="#800000">xsl:value-of </font><font color="#FF00FF">
            </font><font color="#FF0000">disable-output-escaping</font><font color="#0000FF">='yes'
            </font><font color="#FF0000">select</font><font color="#0000FF">='content:encoded'/&gt;
    &lt;/</font><font color="#800000">xsl:when</font><font color="#0000FF">&gt;
    &lt;</font><font color="#800000">xsl:otherwise</font><font color="#0000FF">&gt;
        &lt;</font><font color="#800000">xsl:value-of
            </font><font color="#FF0000">disable-output-escaping</font><font color="#0000FF">='yes'
            </font><font color="#FF0000">select</font><font color="#0000FF">='description'/&gt;
    &lt;/</font><font color="#800000">xsl:otherwise</font><font color="#0000FF">&gt;
&lt;/</font><font color="#800000">xsl:choose</font><font color="#0000FF">&gt;
</font>
</pre>

<p>The end result should work for any feed that is using one of these three methods for exposing their content as a RSS feed (xhtml:body, description, or content:encoding), producing a final display similar to what is shown in Figure 3.</p>

<p><img src="http://www.duncanmackenzie.net/Figure3.png" border="0" /></p>

<p><strong>Figure 3</strong></p>

<p>Now, it is very important to note that whenever you are going to display HTML content that someone else has provided (such as the content inside of an RSS feed), you need to be aware of the possible risks, especially when you are using my method of replacing the contents of the &#8220;about:blank&#8221; page. When HTML is displayed in the embedded browser, it is running within the local zone, which will likely have much lower security restrictions than the Internet zone. Although there are ways in which you can clean up HTML before displaying it, it takes quite a bit of work to guarantee that it is completely safe. Check out <a href="http://diveintomark.org/archives/2003/06/12/how_to_consume_rss_safely">this useful blog post</a> that describes some of the issues caused by HTML in RSS, and gives some suggestions on avoiding them.</p>

<ul>
<li>* *More to come soon&#8230; I&#8217;ve updated the XSLT at</li>
</ul>

<p><a href="http://www.duncanmackenzie.net/rss2html2.zip">http://www.duncanmackenzie.net/rss2html2.zip</a>{.broken_link} for your viewing pleasure&#8230;</p></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/2003-08-13-updating-the-updater/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle"></span>
    </a>
    
    
    <a href="/posts/2003-08-12-and-now-for-the-last/" class="navigation-next">
      <span class="navigation-tittle"></span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
